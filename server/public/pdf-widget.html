<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PDF Exporter</title>
    <style>
      body {
        font-family: system-ui;
        margin: 0;
        padding: 16px;
      }
      h1 {
        font-size: 20px;
        margin: 0 0 12px;
      }
      textarea {
        width: 100%;
        height: 220px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
      }
      .row {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        margin: 10px 0;
      }
      button {
        padding: 10px 14px;
        cursor: pointer;
      }
      .muted {
        color: #666;
        font-size: 12px;
      }
      .out {
        margin-top: 12px;
      }
    </style>
  </head>
  <body>
    <h1>PDF Exporter</h1>

    <div class="row">
      <label>Preset:</label>
      <select id="preset">
        <option value="report">Report</option>
        <option value="notes">Notes</option>
        <option value="resume">Resume</option>
      </select>

      <button id="btn">Generate PDF</button>
      <span id="status" class="muted"></span>
    </div>

    <textarea id="text" placeholder="Paste text here..."></textarea>

    <div id="out" class="out"></div>

    <script>
      const btn = document.getElementById("btn");
      const status = document.getElementById("status");
      const out = document.getElementById("out");

      btn.addEventListener("click", async () => {
        const rawText = document.getElementById("text").value.trim();
        const preset = document.getElementById("preset").value;

        if (!rawText) {
          out.textContent = "Please paste some text first.";
          return;
        }

        btn.disabled = true;
        status.textContent = "Generating…";
        out.textContent = "";

        try {
          const result = await window.openai.callTool({
            name: "create_pdf",
            arguments: { rawText, preset },
          });

          const data = result?.structuredContent ?? result;

          status.textContent = "Done ✅";
          out.innerHTML = `
            <div><strong>${data.fileName || "document.pdf"}</strong></div>
            <a href="${
              data.downloadUrl
            }" target="_blank" rel="noreferrer">Download PDF</a>
          `;
        } catch (e) {
          status.textContent = "";
          out.textContent = "Error: " + (e?.message || "Tool call failed");
        } finally {
          btn.disabled = false;
        }
      });
    </script>
  </body>
</html>
